<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Excel å›¾ç‰‡å¤„ç†</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      gap: 30px;
      padding: 30px;
    }
    .upload-area, .log-area {
      flex: 1;
    }
    .upload-area {
      padding: 20px;
      border: 2px dashed #ccc;
      border-radius: 10px;
    }
    .log-area {
      background: #1e1e1e;
      color: #00ff99;
      padding: 15px;
      height: 500px;
      overflow-y: auto;
      border-radius: 10px;
      font-family: monospace;
      white-space: pre-line;
    }
    button {
      margin-top: 10px;
      padding: 8px 20px;
    }
  </style>
</head>
<body>
  <div class="upload-area">
    <h2>ğŸ“¤ ä¸Šä¼ åŒ…å«å›¾ç‰‡URLçš„Excelæ–‡ä»¶</h2>
    <form id="upload-form" enctype="multipart/form-data">
      <input type="file" name="file" accept=".xlsx" required /><br/>
      <button type="submit">ä¸Šä¼ å¹¶å¤„ç†</button>
    </form>
    <div id="result" style="margin-top: 10px; font-weight: bold;"></div>
  </div>

  <div class="log-area" id="log-box">
    ç­‰å¾…ä¸Šä¼ ...
  </div>

  <script>
    const logBox = document.getElementById('log-box');
    async function fetchLogs() {
      try {
        const res = await fetch('/logs');
        const logs = await res.json();
        logBox.textContent = logs.join('\n') || "ï¼ˆæš‚æ— è¾“å‡ºï¼Œè¯·ç¨ç­‰...ï¼‰";
      } catch (err) {
        logBox.textContent = "âš ï¸ è·å–æ—¥å¿—å¤±è´¥ï¼š" + err.message;
      }
    }
    setInterval(fetchLogs, 1000);

    document.getElementById('upload-form').addEventListener('submit', async function (e) {
      e.preventDefault();
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = "å¤„ç†ä¸­...";

      const formData = new FormData(this);
      try {
        const res = await fetch('/process', {
          method: 'POST',
          body: formData
        });

        if (!res.ok) throw new Error("çŠ¶æ€ç ï¼š" + res.status);

        const blob = await res.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'å›¾ç‰‡é¢„è§ˆç»“æœ.xlsx';
        document.body.appendChild(a);
        a.click();
        a.remove();
        resultDiv.textContent = "âœ… ä¸‹è½½å®Œæˆï¼";
      } catch (err) {
        resultDiv.textContent = "âŒ é”™è¯¯ï¼š" + err.message;
      }
    });
  </script>
</body>
</html>
